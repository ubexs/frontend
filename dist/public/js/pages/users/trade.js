"use strict";function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}var userData=$("#userdata"),userid=userData.attr("data-userid"),traderData=$("#tradedata"),traderId=traderData.attr("data-userid"),mode=traderData.attr("data-mode"),metadata={isEnabled:!1,maxItemsPerSide:4,maxRequestPrimary:100,maxOfferPrimary:100},getMetaData=function(){return request("/economy/trades/metadata","GET").then(function(a){metadata=a})};getMetaData().then()["catch"](function(a){throw warning("Oops, it looks like something went wrong loading this page.",function(){window.location.reload()}),a});/**
 * @type {{userInventoryId: number; catalogId: number; catalogName: string; serial: number|undefined}[]}
 */var CurrentOffer=[],inOffer=function(a){var b,c=_createForOfIteratorHelper(CurrentOffer);try{for(c.s();!(b=c.n()).done;){var d=b.value;if(d.userInventoryId===a)return!0}}catch(a){c.e(a)}finally{c.f()}return!1},currentOfferPrimary=0,CurrentRequest=[],inRequest=function(a){if("CreateTradeAd"===mode)return!1;var b,c=_createForOfIteratorHelper(CurrentRequest);try{for(c.s();!(b=c.n()).done;){var d=b.value;if(d.userInventoryId===a)return!0}}catch(a){c.e(a)}finally{c.f()}return!1},currentRequestPrimary=0,loadItems=function(a){if(!a.isLoading){a.isLoading=!0;var b=$(a.div).innerHeight(),c=Math.round(b/2-16)+"px",d=Math.round(b/2-16)+"px";$(a.div).empty(),$(a.div).append("\n    \n    <div class=\"col-12\" style=\"margin-top:".concat(c,";margin-bottom:").concat(d,";\">\n        <div class=\"spinner-border\" role=\"status\" style=\"margin:0 auto;display: block;\">\n            <span class=\"sr-only\">Loading...</span>\n        </div>\n    </div>\n    \n    "));// this is to prevent searching up "undefined" literally (or empty strings)
var e="";a.query&&(e=a.query);var f="/user/"+a.userId+"/inventory/collectibles?limit=6&offset="+a.offset+"&query="+e;return"CreateTradeAd"!==mode||a.userId||(f="/catalog?offset="+a.offset+"&limit=6&category=20&orderBy=id&orderByType=desc&query="+e),request(f,"GET").then(function(b){console.log(".then"),$(a.div).empty(),a.isLoading=!1;var c=b.items;if("CreateTradeAd"!==mode||a.userId||(c=b),0===c.length)return $(a.div).parent().find("span.next-page").css("opacity","0.5"),$(a.div).append("\n            \n            <div class=\"col-12\" style=\"margin-top:8rem;margin-bottom:8rem;\">\n                <p style=\"text-align:center;\">Oops, it looks like there aren't any items to show.</p>\n            </div>\n            \n            "),void(a.areMoreAvailable=!1);var d,e=[],f=_createForOfIteratorHelper(c);try{for(f.s();!(d=f.n()).done;){var h=d.value;e.push(h.catalogId);var i="";h.serial&&(i="<p style=\"font-size:0.65rem;margin-bottom:-1rem;margin-left:0.15rem;z-index:2;\" class=\"text-truncate\">Serial: ".concat(number_format(h.serial),"</p>"));var j="trade-item-".concat(a.div.slice(1));(inOffer(h.userInventoryId)||inRequest(h.userInventoryId))&&(j="remove-item-".concat(a.div.slice(1)," item-in-trade-request-or-offer")),$(a.div).append("\n            \n            <div class=\"col-6 col-md-4 trade-card-hover ".concat(j,"\" style=\"margin-bottom:1rem;\" \n            data-userinventoryid=\"").concat(h.userInventoryId,"\" \n            data-serial=\"").concat(h.serial,"\"\n            data-catalogname=\"").concat(xss(h.catalogName),"\"\n            data-catalogid=\"").concat(h.catalogId,"\"\n            data-averageprice=\"").concat(h.averagePrice,"\"\n            >\n                <div class=\"card\">\n                    ").concat(i,"\n                    <img src=\"").concat(window.subsitutionimageurl,"\" style=\"width:100%;height:auto;margin:0 auto;display:block;max-width:100px;\" data-catalogid=\"").concat(h.catalogId,"\" />\n                    <p style=\"font-size:0.85rem;font-weight:500;\" class=\"text-truncate\">").concat(xss(h.catalogName),"</p>\n                    <p style=\"font-size:0.65rem;\" class=\"text-truncate\">").concat(formatCurrency(1,"0.65rem")," ").concat(number_format(h.averagePrice),"</p>\n                </div>\n            </div>\n            \n            "))}}catch(a){f.e(a)}finally{f.f()}setCatalogThumbs(e),0===a.offset?$(a.div+"-pagination").find(".previous-page").css("opacity","0.5"):$(a.div+"-pagination").find(".previous-page").css("opacity","1");var g=b.areMoreAvailable;"CreateTradeAd"!==mode||b.items||(6<=b.length?g=!0:g=!1),g?(a.areMoreAvailable=!0,a.offset+=6,$(a.div+"-pagination").find(".next-page").css("opacity","1")):(a.areMoreAvailable=!1,$(a.div+"-pagination").find(".next-page").css("opacity","0.5")),console.log(b)})["catch"](function(b){console.error(b),a.isLoading=!1})}},currentUserPager={isLoading:!1,userId:userid,offset:0,query:void 0,div:"#requester-items",areMoreAvailable:!0};loadItems(currentUserPager);var partnerPager={isLoading:!1,userId:traderId,offset:0,query:void 0,div:"#requestee-items",areMoreAvailable:!0};loadItems(partnerPager),$("#search-requester-click").click(function(a){var b=this;a.preventDefault(),$(this).attr("disabled","disabled"),$("#search-requester").attr("disabled","disalbed"),currentUserPager.query=$("#search-requester").val(),currentUserPager.offset=0,$(this).parent().parent().parent().find("span.current-page").html("&emsp;Page 1&emsp;"),$(this).parent().parent().parent().find("span.previous-page").css("opacity","0.5"),loadItems(currentUserPager).then(function(){$(b).removeAttr("disabled"),$("#search-requester").removeAttr("disabled")})["catch"](function(){$(b).removeAttr("disabled"),$("#search-requester").removeAttr("disabled")})}),$("#search-requestee-click").click(function(a){var b=this;a.preventDefault(),$(this).attr("disabled","disabled"),$("#search-requestee").attr("disabled","disalbed"),partnerPager.query=$("#search-requestee").val(),partnerPager.offset=0,$("#search-requestee-click").parent().parent().parent().find("span.current-page").html("&emsp;Page 1&emsp;"),$(this).parent().parent().parent().find("span.previous-page").css("opacity","0.5"),loadItems(partnerPager).then(function(){$(b).removeAttr("disabled"),$("#search-requestee").removeAttr("disabled")})["catch"](function(){$(b).removeAttr("disabled"),$("#search-requestee").removeAttr("disabled")})}),$("#requester-items-pagination").find(".next-page").click(function(a){if(console.log("Click!"),a.preventDefault(),"0.5"!==$(this).css("opacity")){$(this).css("opacity","0.5");var b=currentUserPager.offset/6;b++,$("#requester-items-pagination").find("span.current-page").html("&emsp;Page "+b+"&emsp;"),loadItems(currentUserPager)}}),$("#requester-items-pagination").find(".previous-page").click(function(a){if(console.log("Click!"),a.preventDefault(),"0.5"!==$(this).css("opacity")){$(this).css("opacity","0.5"),currentUserPager.offset-=currentUserPager.areMoreAvailable?12:6;var b=currentUserPager.offset/6;b++,$("#requester-items-pagination").find("span.current-page").html("&emsp;Page "+b+"&emsp;"),loadItems(currentUserPager)}}),$("#requestee-items-pagination").find(".next-page").click(function(a){if(console.log("Click!"),a.preventDefault(),"0.5"!==$(this).css("opacity")){$(this).css("opacity","0.5");var b=partnerPager.offset/6;b++,$("#requestee-items-pagination").find("span.current-page").html("&emsp;Page "+b+"&emsp;"),loadItems(partnerPager)}}),$("#requestee-items-pagination").find(".previous-page").click(function(a){if(console.log("Click!"),a.preventDefault(),"0.5"!==$(this).css("opacity")){$(this).css("opacity","0.5"),console.log(partnerPager.areMoreAvailable),partnerPager.offset-=partnerPager.areMoreAvailable?12:6;var b=partnerPager.offset/6;b++,$("#requestee-items-pagination").find("span.current-page").html("&emsp;Page "+b+"&emsp;"),loadItems(partnerPager)}}),$("#total-offer-value").html("Total Value: ".concat(formatCurrency(1,"1rem")," 0")),$("#total-request-value").html("Total Value: ".concat(formatCurrency(1,"1rem")," 0"));// add item to authenticated users offer
var setupOfferArea=function(){var a=parseInt($("#currency-offer").val(),10);a||(a=0),1e6<=a&&(a=1e6,$("#currency-offer").val(1e6)),currentOfferPrimary=a;var b=a;if(0!==CurrentOffer.length&&0!==CurrentRequest.length?$("#send-trade").removeAttr("disabled"):$("#send-trade").attr("disabled","disabled"),$("#offer-items").empty(),0===CurrentOffer.length)return $("#total-offer-value").html("Total Value: ".concat(formatCurrency(1,"1rem")," ").concat(number_format(b))),void $("#offer-items").append("\n        \n        <div class=\"col-12\">\n            <p style=\"text-align:center;margin-top:2rem;opacity:0.5;font-weight:600;\">You have not offered any items yet.</p>\n        </div>\n        \n        ");var c,d=[],e=_createForOfIteratorHelper(CurrentOffer);try{for(e.s();!(c=e.n()).done;){var f=c.value;b+=f.averagePrice,d.push(f.catalogId);var g="<p style=\"font-size:0.65rem;font-weight:400;\">&emsp;</p>";f.serial&&(g="<p style=\"font-size:0.65rem;font-weight:400;\">Serial: ".concat(number_format(f.serial),"</p>")),$("#offer-items").append("\n        \n        <div class=\"col-12 remove-item-requester-items item-in-trade-request-or-offer-sidebar\" style=\"cursor:pointer;\" data-userinventoryid=\"".concat(f.userInventoryId,"\" data-catalogid=\"").concat(f.catalogId,"\">\n            <div class=\"row\">\n                <div class=\"col-4\">\n                    <img src=\"").concat(window.subsitutionimageurl,"\" style=\"width:100%;height:auto;display:block;margin:0 auto;max-width:70px;\" data-catalogid=\"").concat(f.catalogId,"\" />\n                </div>\n                <div class=\"col-8\">\n                    <p style=\"font-size:0.85rem;margin-bottom:0;font-weight:600;\">").concat(xss(f.catalogName),"</p>\n                    <p style=\"font-size:0.65rem;margin-bottom:0;font-weight:400;\">").concat(formatCurrency(1,"0.65rem")+" "+xss(number_format(f.averagePrice)),"</p>\n                    ").concat(g,"\n                </div>\n            </div>\n            \n        </div>\n        "))}}catch(a){e.e(a)}finally{e.f()}$("#total-offer-value").html("Total Value: ".concat(formatCurrency(1,"1rem")," ").concat(number_format(b))),setCatalogThumbs(d)};$(document).on("click",".trade-item-requester-items",function(a){a.preventDefault();var b=parseInt($(this).attr("data-userinventoryid"),10),c=parseInt($(this).attr("data-serial"),10),d=parseInt($(this).attr("data-averageprice"),10);isNaN(c)&&(c=void 0);var e=parseInt($(this).attr("data-catalogid")),f=$(this).attr("data-catalogname");// check if already exists
return inOffer(b)||inRequest(b)?void 0:CurrentOffer.length>=metadata.maxItemsPerSide?void warning("You can only include up to "+metadata.maxItemsPerSide+" items, per user, in a trade."):void(CurrentOffer.push({userInventoryId:b,catalogId:e,catalogName:f,serial:c,averagePrice:d}),setupOfferArea(),$(this).attr("class","col-6 col-md-4 trade-card-hover remove-item-".concat(currentUserPager.div.slice(1)," item-in-trade-request-or-offer")))}),$(document).on("click",".remove-item-requester-items",function(a){a.preventDefault();var b=parseInt($(this).attr("data-userinventoryid"),10);// check if already exists
if(inOffer(b)||inRequest(b)){var c,d=[],e=_createForOfIteratorHelper(CurrentOffer);try{for(e.s();!(c=e.n()).done;){var f=c.value;f.userInventoryId!==b&&d.push(f)}}catch(a){e.e(a)}finally{e.f()}return CurrentOffer=d,$(".remove-item-requester-items.item-in-trade-request-or-offer[data-userinventoryid=\""+b+"\"]").attr("class","col-6 col-md-4 trade-card-hover trade-item-".concat(currentUserPager.div.slice(1))),$(".remove-item-requester-items.item-in-trade-request-or-offer-sidebar[data-userinventoryid=\""+b+"\"]").remove(),void setupOfferArea()}});// add item to authenticated users request
var setupRequestArea=function(){var a=parseInt($("#currency-request").val(),10);a||(a=0),1e6<=a&&(a=1e6,$("#currency-request").val(1e6)),currentRequestPrimary=a;var b=a;if(0!==CurrentOffer.length&&0!==CurrentRequest.length?$("#send-trade").removeAttr("disabled"):$("#send-trade").attr("disabled","disabled"),$("#request-items").empty(),0===CurrentRequest.length)return $("#total-request-value").html("Total Value: ".concat(formatCurrency(1,"1rem")," ").concat(number_format(b))),void $("#request-items").append("\n        \n        <div class=\"col-12\">\n            <p style=\"text-align:center;margin-top:2rem;opacity:0.5;font-weight:600;\">You have not requested any items yet.</p>\n        </div>\n        \n        ");var c=[];console.log("total asp",b);var d,e=_createForOfIteratorHelper(CurrentRequest);try{for(e.s();!(d=e.n()).done;){var f=d.value;b+=f.averagePrice,c.push(f.catalogId);var g="<p style=\"font-size:0.65rem;font-weight:400;\">&emsp;</p>";f.serial&&(console.log("item has serial!!!!!"),g="<p style=\"font-size:0.65rem;font-weight:400;\">Serial: ".concat(number_format(f.serial),"</p>")),$("#request-items").append("\n        \n        <div class=\"col-12 remove-item-requestee-items item-in-trade-request-or-offer-sidebar\" style=\"cursor:pointer;\" data-userinventoryid=\"".concat(f.userInventoryId,"\" data-catalogid=\"").concat(f.catalogId,"\">\n            <div class=\"row\">\n                <div class=\"col-4\">\n                    <img src=\"").concat(window.subsitutionimageurl,"\" style=\"width:100%;height:auto;display:block;margin:0 auto;max-width:70px;\" data-catalogid=\"").concat(f.catalogId,"\" />\n                </div>\n                <div class=\"col-8\">\n                    <p style=\"font-size:0.85rem;margin-bottom:0;font-weight:600;\">").concat(xss(f.catalogName),"</p>\n                    <p style=\"font-size:0.65rem;margin-bottom:0;font-weight:400;\">").concat(formatCurrency(1,"0.65rem")+" "+xss(number_format(f.averagePrice)),"</p>\n                    ").concat(g,"\n                </div>\n            </div>\n            \n        </div>\n        "))}}catch(a){e.e(a)}finally{e.f()}$("#total-request-value").html("Total Value: ".concat(formatCurrency(1,"1rem")," ").concat(number_format(b))),setCatalogThumbs(c)};$(document).on("input","#currency-request",function(a){a.preventDefault(),setupRequestArea()}),$(document).on("input","#currency-offer",function(a){a.preventDefault(),setupOfferArea()}),$(document).on("click",".trade-item-requestee-items",function(a){a.preventDefault();var b=parseInt($(this).attr("data-userinventoryid"),10),c=parseInt($(this).attr("data-serial"),10),d=parseInt($(this).attr("data-averageprice"),10);isNaN(c)&&(c=void 0);var e=parseInt($(this).attr("data-catalogid")),f=$(this).attr("data-catalogname");// check if already exists
return inOffer(b)||inRequest(b)?void 0:CurrentRequest.length>=metadata.maxItemsPerSide?void warning("You can only include up to "+metadata.maxItemsPerSide+" items, per user, in a trade."):void(CurrentRequest.push({userInventoryId:b,catalogId:e,catalogName:f,serial:c,averagePrice:d}),setupRequestArea(),"TradeWithUser"===mode&&$(this).attr("class","col-6 col-md-4 trade-card-hover remove-item-".concat(partnerPager.div.slice(1)," item-in-trade-request-or-offer")))}),$(document).on("click",".remove-item-requestee-items",function(a){a.preventDefault();var b=parseInt($(this).attr("data-userinventoryid"),10),c=parseInt($(this).attr("data-catalogid"),10);if("CreateTradeAd"===mode){var d,e=!1,f=[],g=_createForOfIteratorHelper(CurrentRequest);try{for(g.s();!(d=g.n()).done;){var k=d.value;k.catalogId===c?e?f.push(k):e=!0:f.push(k)}}catch(a){g.e(a)}finally{g.f()}return CurrentRequest=f,void setupRequestArea()}// check if already exists
if(inOffer(b)||inRequest(b)){var h,i=[],j=_createForOfIteratorHelper(CurrentRequest);try{for(j.s();!(h=j.n()).done;){var l=h.value;l.userInventoryId!==b&&i.push(l)}}catch(a){j.e(a)}finally{j.f()}return CurrentRequest=i,$(".remove-item-requestee-items.item-in-trade-request-or-offer[data-userinventoryid=\""+b+"\"]").attr("class","col-6 col-md-4 trade-card-hover trade-item-".concat(partnerPager.div.slice(1))),$(".remove-item-requestee-items.item-in-trade-request-or-offer-sidebar[data-userinventoryid=\""+b+"\"]").remove(),void setupRequestArea()}}),$(document).on("click","#send-trade",function(){var a="Are you sure you want to send this trade?",b="/economy/trades/user/"+traderId+"/request",c=[];CurrentOffer.forEach(function(a){return c.push(a.userInventoryId)});var d=[];CurrentRequest.forEach(function(a){return d.push(a.userInventoryId)});var e={offerItems:c,requestedItems:d,requestPrimary:currentRequestPrimary,offerPrimary:currentOfferPrimary};"CreateTradeAd"===mode&&(a="Are you sure you want to create this trade ad?<br><br><p style=\"font-size:0.75rem;margin:1rem 0 0 0;padding:0;\">Note that the serials you get from this trade will be random, as anybody can complete it.</p>",b="/trade-ads/ad/create",e={offerItems:CurrentOffer.map(function(a){return{userInventoryId:a.userInventoryId}}),requestItems:CurrentRequest.map(function(a){return{catalogId:a.catalogId}}),requestPrimary:currentRequestPrimary,offerPrimary:currentOfferPrimary}),questionYesNoHtml(a,function(){//questionYesNo('Sending trade...', function() {
loading(),request(b,"PUT",e).then(function(){success("Your trade has been created. You can review its status in the trades page.",function(){window.location.reload()})})["catch"](function(a){if(console.error(a),a&&a.responseJSON&&a.responseJSON.message)warning(a.responseJSON.message);else{var b="UnknownException";a&&a.responseJSON&&a.responseJSON.error&&a.responseJSON.error.code&&(b=a.responseJSON.error.code),warning("An unknown error has occurred. Please try again. Code: "+b)}})})});