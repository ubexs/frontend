"use strict";function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}$("#deleteUserBlurb").click(function(){request("/staff/user/"+$("#userId").val()+"/blurb","DELETE").then(function(){success("This user's blurb has been deleted."),$("#userblurb").val("[ Content Deleted ]")})["catch"](function(a){warning(a.responseJSON.message)})}),$("#deleteUserStatus").click(function(){request("/staff/user/"+$("#userId").val()+"/status","DELETE").then(function(){success("This user's status has been deleted."),$("#userstatus").val("[ Content Deleted ]")})["catch"](function(a){warning(a.responseJSON.message)})}),$("#deleteUserForumSignature").click(function(){request("/staff/user/"+$("#userId").val()+"/forum/signature","DELETE").then(function(){success("This user's forum signature has been deleted."),$("#userforumsignature").val("[ Content Deleted ]")})["catch"](function(a){warning(a.responseJSON.message)})}),$("#disableTwoFactor").click(function(){questionYesNo("Are you sure you'd like to disable 2FA for this user?",function(){request("/staff/user/"+$("#userId").val()+"/two-factor","DELETE").then(function(){success("This user's two-factor authentication has been disabled."),$("#two-factor-enabled").empty().append("<span style=\"font-weight:600;\" id=\"two-factor-enabled\">2-Factor Enabled: </span><span style=\"font-weight:100;\">No</span>")})["catch"](function(a){warning(a.responseJSON.message)})})}),$("#deleteUserPrimaryBalance").click(function(){questionYesNo("Are you sure you'd like to clear the primary balance of this user?",function(){request("/staff/user/"+$("#userId").val()+"/clear-balance/1","DELETE").then(function(){success("This user's balance has been cleared."),$("#user-balance-primary").empty().append("0")})["catch"](function(a){warning(a.responseJSON.message)})})}),$("#deleteUserSecondaryBalance").click(function(){questionYesNo("Are you sure you'd like to clear the secondary balance of this user?",function(){request("/staff/user/"+$("#userId").val()+"/clear-balance/2","DELETE").then(function(){success("This user's balance has been cleared."),$("#user-balance-secondary").empty().append("0")})["catch"](function(a){warning(a.responseJSON.message)})})}),$(document).on("click","#sendStaffComment",function(){var a=$("#staffCommentText").val();request("/staff/user/"+$("#userId").val()+"/comment","POST",JSON.stringify({comment:a})).then(function(){window.location.reload()})["catch"](function(a){warning(a.responseJSON.message)})}),request("/staff/user/"+$("#userId").val()+"/associated-accounts").then(function(a){var b,c=function(a){return 1===a?"Same IP Address":void 0},d=[],e=_createForOfIteratorHelper(a.accounts);try{for(e.s();!(b=e.n()).done;){var f=b.value;d.push(f.userId),$("#associatedAccountsArray").append("\n        <div class=\"row\" style=\"padding-top:1rem;\">\n            <div class=\"col-12\">\n                <p>Username: <a href=\"/staff/user/profile?userId=".concat(f.userId,"\"><span data-userid=\"").concat(f.userId,"\">N/A</span></a></p>\n                <p>Reason: ").concat(c(f.reason),"</p>\n                <hr />\n            </div>\n        </div>"))}}catch(a){e.e(a)}finally{e.f()}setUserNames(d)})["catch"](function(){$("#associatedAccountsArray").html("<p>There was an error loading the accounts. Try again later.</p>")}),$(document).on("click",".delete-comment",function(a){a.preventDefault();var b=parseInt($(this).attr("data-comment-id"),10);void 0,request("/staff/user/"+$("#userId").val()+"/comments/"+b,"DELETE",{}).then(function(){window.location.reload()})});function onMessageContent(){var a=$("#staffMessageSubject").val(),b=$("#staffMessageText").val();5<=b.length&&5<=a.length?$("#sendStaffMessage").removeAttr("disabled"):$("#sendStaffMessage").attr("disabled","disabled")}$(document).on("change","#staffMessageSubject",onMessageContent),$(document).on("change","#staffMessageText",onMessageContent),$(document).on("click","#sendStaffMessage",function(a){a.preventDefault(),questionYesNo("Are you sure you want to send a message?",function(){var a=$("#staffMessageSubject").val(),b=$("#staffMessageText").val();request("/staff/user/"+$("#userId").val()+"/message","POST",{subject:a,message:b}).then(function(){success("The message has been sent.")})["catch"](function(a){warning(a.responseJSON.message)})})}),$(document).on("click",".remove-email",function(a){var b=this;a.preventDefault(),questionYesNo("Are you sure you want to delete this email?",function(){request("/staff/user/email/"+$(b).attr("data-email-id"),"DELETE",{}).then(function(){success("This email has been removed.");var a=$(".associated-emails-table").find("tbody").children().length;void 0,1===a?($(".associated-emails-table").parent().append("<p>This user does not have any associated emails</p>"),$(".associated-emails-table").remove()):$(b).parent().parent().remove()})})}),$(document).on("click","#open-ban-data",function(){$("#ban-data-form").toggle()}),$(document).on("click","#open-moderation-history",function(){$("#moderation-history-table").toggle()}),$(document).on("click","#open-staff-message-board",function(){$("#staff-comments-list").toggle()}),$(document).on("click","#open-associated-accounts",function(){$("#associatedAccountsArray").toggle()}),$(document).on("click","#open-staff-permissions",function(){$("#staff-permissions").toggle()}),$(document).on("click","#open-cs-currency-list",function(){$("#cs-currency-list").toggle()});var givenCurrencyLoading=!1,givenCurrencyOffset=0,givenCurrencyLimit=25,areMoreCurrencyGiven=!1,loadGivenCurrency=function(){givenCurrencyLoading||(givenCurrencyLoading=!0,request("/staff/user/"+$("#userId").val()+"/received-currency?limit="+givenCurrencyLimit+"&offset="+givenCurrencyOffset,"GET").then(function(a){givenCurrencyLoading=!1,areMoreCurrencyGiven=a.length>=givenCurrencyLimit,areMoreCurrencyGiven&&(givenCurrencyOffset+=givenCurrencyLimit);var b,c=[],d=_createForOfIteratorHelper(a);try{for(d.s();!(b=d.n()).done;){var e=b.value;c.push(e.userIdGiver),$("#cs-currency-list").append("\n            \n            <div class=\"row\">\n                <div class=\"col-6\">\n                    <p>".concat(formatCurrency(e.currency),"  ").concat(e.amount,"</p>\n                </div>\n                <div class=\"col-6\">\n                    <p style=\"font-size:0.85rem;\"><span data-userid=\"").concat(e.userIdGiver,"\">Loading...</span> -  ").concat(moment(e.date).fromNow(),"</p>\n                </div>\n            </div>\n            \n            "))}}catch(a){d.e(a)}finally{d.f()}setUserNames(c)})["catch"](function(){void 0,areMoreCurrencyGiven=!1,givenCurrencyLoading=!1}))};loadGivenCurrency();var commentsLoading=!1,areThereMoreComments=!1,getComments=function(a){commentsLoading||(commentsLoading=!0,request("/staff/user/"+$("#userId").val()+"/comments?offset="+a).then(function(b){var c=[];0===b.comments.length&&0===a&&$("#staffComments").append("\n            <div class=\"col-12\">\n                <p>This user does not have any comments</p>\n            </div>\n            "),25<=b.comments.length&&(areThereMoreComments=!0);var d,e=_createForOfIteratorHelper(b.comments);try{for(e.s();!(d=e.n()).done;){var f=d.value;c.push(f.staffUserId);var g="";f.staffUserId===userId&&(g="<p style=\"margin-top:1rem;color:red;cursor:pointer;\" class=\"delete-comment\" data-comment-id=\"".concat(f.userCommentId,"\">Delete</p>")),$("#staffComments").append("\n            <div class=\"col-12\" style=\"padding-top:0.5rem;\">\n                <div class=\"row\">\n                    <div class=\"col-12 col-md-2\">\n                        <img data-userid=\"".concat(f.staffUserId,"\" style=\"width:100%;max-width:150px;margin:0 auto;display: block;\" />\n                        <p class=\"text-center\">\n                            <span data-userid=\"").concat(f.staffUserId,"\" style=\"font-weight:600;\"></span>\n                        </p>\n                        <p class=\"text-center\">\n                            <span>").concat(moment(f.dateCreated).format("DD MMM YYYY"),"</span>\n                        </p>\n                    </div>\n                    <div class=\"col-12 col-md-10\">\n                        <p>").concat(f.comment.escapeAllowFormattingBasic(),"</p>\n                        ").concat(g,"\n                    </div>\n                </div>\n                <div class=\"row\">\n                    <div class=\"col-12\">\n                        <hr />\n                    </div>\n                </div>\n            </div>\n            "))}}catch(a){e.e(a)}finally{e.f()}commentsLoading=!1,setUserThumbs(c),setUserNames(c)})["catch"](function(){void 0,commentsLoading=!1}))};getComments(0);var _isDevLocked=!1;$("#is-developer").change(function(){var a=this;void 0,$(this).attr("disabled","disabled"),_isDevLocked=!0,request("/staff/user/"+$("#userId").val()+"/game-dev","POST",{isDeveloper:"true"===$(this).val()}).then(function(){toast(!0,"This users game dev state has been modified."),$(a).removeAttr("disabled")})["catch"](function(b){$(a).removeAttr("disabled"),warning(b.responseJSON.message)})}),$(document).on("click","#uncheck-all-full-permissions",function(a){a.preventDefault(),$(".update-permissions-checkbox").each(function(){$(this).prop("checked",!1)})});var loadModHistoryNames=function(){var a=[];$("span.mod-history").each(function(){a.push(parseInt($(this).attr("data-userid")))}),setUserNames(a)};loadModHistoryNames(),$(document).on("click","#update-full-permissions",function(a){a.preventDefault();var b=$("#userId").val();loading(),request("/staff/permissions/"+b,"GET").then(function(a){var c=[];$(".update-permissions-checkbox").each(function(){$(this).is(":checked")?c.push({name:$(this).attr("data-permission"),selected:!0}):c.push({name:$(this).attr("data-permission"),selected:!1})});for(var d=[],e=0,f=c;e<f.length;e++){var g=f[e],h=g.name;var i=a[h];void 0,g.selected?"undefined"==typeof i&&d.push(request("/staff/permissions/"+b+"/"+g.name,"PUT")["catch"](function(){})):"undefined"!=typeof i&&d.push(request("/staff/permissions/"+b+"/"+g.name,"DELETE")["catch"](function(){}))}Promise.all(d).then(function(){success("The permissions for this user have been updated.")})["catch"](function(a){throw warning(a.responseJSON.message||"An unknown error has occurred."),a})})["catch"](function(a){throw a})});