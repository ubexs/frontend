"use strict";function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}var profile={userId:parseInt($("#profile-info").attr("data-userid"),10)},takeItemsState={loading:!1,canLoadMore:!0,offset:0,limit:100,query:""},card=$("#main-card");$(document).on("click","#take-items",function(a){a.preventDefault(),card.empty(),card.append("\n    <div class=\"row\" style=\"margin-bottom:1rem;\">\n        <div class=\"col s6\">\n            <h3>Take Items</h3>\n            <p style=\"font-size:0.85rem;\">Click on one or more items to select them, then press submit to continue.</p>\n        </div>\n        <div class=\"col s6\">\n            <button style=\"float:right;\" type=\"button\" class=\"btn btn-secondary\" id=\"submit-take-items-request\">Submit</button>\n        </div>\n    </div>"),card.append("<div class=\"row\" id=\"loading\"><div class=\"col s12\">Loading...</div></div>"),loadItemsToTake()});var getSelectedItems=function(){var a=[];return $(".remove-item-card").each(function(){"true"===$(this).attr("data-selected")&&a.push(parseInt($(this).attr("data-user-inventory-id"),10))}),a};$(document).on("click","div.row.load-more-items-row",function(a){a.preventDefault(),loadItemsToTake()}),$(document).on("click","#submit-take-items-request",function(a){a.preventDefault();var b=getSelectedItems();return 0===b.length?warning("You must select at least one item."):void questionYesNoHtml("Please confirm the userInventoryIds are OK:<br>"+b.join("<br>"),function(){question("Enter the username of the new owner.",function(a){loading(),request("/user/username?username="+a,"GET").then(function(a){var c=a.userId;request("/staff/user/inventory/transfer-item","PATCH",{userIdTo:c,userIdFrom:profile.userId,userInventoryIds:b}).then(function(){success("The items specified were transferred.",function(){window.location.reload()})})["catch"](function(a){return a.responseJSON&&a.responseJSON.message?warning(a.responseJSON.message):warning("An unknown error has occurred")})})["catch"](function(){warning("The username you specified is invalid.")})}),$("input.swal2-input").val("BadDecisions")})}),$(document).on("click",".remove-item-card",function(a){a.preventDefault();var b=$(this).attr("data-selected");"true"===b?($(this).attr("data-selected","false"),$(this).css("border","none")):($(this).attr("data-selected",!0),$(this).css("border","4px solid green"))});var loadItemsToTake=function(){var a=card.find("div.row.take-items-row");a&&a.length||(card.append("<div class=\"row take-items-row\"></div>"),a=card.find("div.row.take-items-row"));var b=card.find("div.row.load-more-items-row");b&&b.length||(card.append("<div class=\"row load-more-items-row\"></div>"),b=card.find("div.row.load-more-items-row"),b.append("<div class=\"col-12\"><p style=\"margin-top:2rem;font-weight:700;\">Load More</p></div>"));takeItemsState.loading||!takeItemsState.canLoadMore||(takeItemsState.loading=!0,b.hide(),request("/user/"+profile.userId+"/inventory/collectibles?offset="+takeItemsState.offset+"&limit="+takeItemsState.limit+"&query="+takeItemsState.query,"GET").then(function(c){void 0,takeItemsState.offset+=100,takeItemsState.canLoadMore=c.areMoreAvailable,takeItemsState.canLoadMore?b.show():b.hide(),card.find("#loading").remove();var d,e=[],f=_createForOfIteratorHelper(c.items);try{for(f.s();!(d=f.n()).done;){var g=d.value;e.push(g.catalogId);var h="<p style=\"font-size:0.75rem;\">User Inventory ID: "+g.userInventoryId+"</p>";g.serial&&(h="<p style=\"font-size:0.75rem;\">Serial: #"+g.serial+" ("+g.userInventoryId+")</p>"),a.append("\n            <div class=\"col-6 col-md-4 col-lg-3 col-xl-2 remove-item-card\" data-user-inventory-id=\"".concat(g.userInventoryId,"\">\n                <img src=\"").concat(window.subsitutionimageurl,"\" style=\"width: 100%;height:auto;display: block;\" data-catalogid=\"").concat(g.catalogId,"\" />\n                <p>").concat(xss(g.catalogName),"</p>\n                ").concat(h,"\n            </div>\n            \n            "))}}catch(a){f.e(a)}finally{f.f()}setCatalogThumbs(e)})["finally"](function(){takeItemsState.loading=!1}))};